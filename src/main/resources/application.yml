server:
  port: 8080
  address: 0.0.0.0  # telefon erişimi için

spring:
  datasource:
    url: ${SOUNDCONNECT_POSTGRE_URL}
    username: ${SOUNDCONNECT_POSTGRE_USERNAME}
    password: ${SOUNDCONNECT_POSTGRE_PASSWORD}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
        type:
          descriptor:
            sql: trace

  rabbitmq:
    host: localhost
    port: 5673            # LOCAL: delayed plugin'li container (rabbit-delayed) -> 5673
    username: guest
    password: guest
    virtual-host: /
    publisher-confirm-type: correlated
    publisher-returns: true
    template:
      mandatory: true  # publish-returns çalışsın (routing yoksa yakalayabilelim)

  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            redirect-uri: "{baseUrl}/api/auth/google/callback"
            scope: [openid, email, profile]
        provider:
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://openidconnect.googleapis.com/v1/userinfo
            user-name-attribute: email

  data:
    redis:
      host: localhost
      port: 6379
    rest:
      default-media-type:
  hateoas:
    use-hal-as-default-json-media-type:

springdoc:
  swagger-ui:
    path: /swagger-ui.html

app:
  jwt:
    secret: ${SOUNDCONNECT_JWT_SECRETKEY}
    expiration: ${SOUNDCONNECT_JWT_EXTIME}
    issuer: ${SOUNDCONNECT_JWT_ISSUER}
  data:
    init:
      enabled: true     # RUNTIME’DA AÇIK (prod’da kapatacağız)
  location:
    seed:
      enabled: true     # başlangıç verisi gerekiyorsa AÇIK
  messaging:
    notification:
      exchange: notification.exchange
      queue: notification.queue
      routingKey: notification.#
      dlxExchange: notification.dlx
      dlq: notification.queue.dlq

otp:
  ttl:
    minutes: 3
  length: 6
  max-attempt: 5
  resend:
    cooldown:
      seconds: 30

mailersend:
  api-key: ${MAILERSEND_API_KEY}
  from-email: ${MAILERSEND_SENDER_EMAIL}
  from-name: SoundConnect
  connectTimeoutMs: 5000
  readTimeoutSec: 8
  otp-validity-minutes: 3  # mail içeriğindeki süre — otp.ttl ile senkron

# -------- MAIL (yeni) --------
mail:
  exchange: mail.exchange
  routingKey: mail.send
  queueName: mail.queue
  dlx: mail.dlx
  dlq: mail.queue.dlq
  ttlMs: 120000            # 2 dk message TTL
  listener:
    concurrency: 1-5       # custom containerFactory için kullanılacak
    prefetch: 10
  idempotencyTtlSec: 900   # 15 dk
  lockTtlSec: 300
  producer:
    confirmTimeoutSec: 5      # producer confirm timeout
  maxRedeliveries: 5          # tüketicide retry limiti
  delayed:
    exchange: mail.delayed    # x-delayed-message exchange adı
  retry:
    delaysMs: [3000, 10000, 30000]  # 3s -> 10s -> 30s (attempt 1/2/3 ...)
    useRetryAfter: true             # 429 varsa Retry-After'ı dikkate al

# -----------------------------

logging:
  level:
    root: INFO
    org.springframework.web: DEBUG
    org.hibernate.SQL: DEBUG

# --- MEDIA / STORAGE ---
cloud:
  storage:
    provider: s3
    bucket: soundconnect-media
    region: eu-central-1
    accessKey: ${S3_ACCESS_KEY}
    secretKey: ${S3_SECRET_KEY}
    cdnBaseUrl: https://du3pguch18ell.cloudfront.net
    endpoint: ""
    pathStyleAccess: false
    presign:
      expirySeconds: 900
    aclPublicReadOnPut: false

media:
  limits:
    imageMaxBytes: 20000000
    audioMaxBytes: 200000000
    videoMaxBytes: 4000000000
  allowedMime:
    image: [image/png, image/jpeg, image/webp]
    audio: [audio/mpeg, audio/aac, audio/wav, audio/x-wav, audio/ogg]
    video: [video/mp4, video/quicktime, video/x-matroska]
  paths:
    root: media
    hlsDir: hls
    sourceBasename: source

rabbitmq:
  media:
    exchange: media.transcode
    dlx: media.transcode.dlx
    queues:
      videoHls: media.transcode.video.hls
      videoHlsDlq: media.transcode.video.hls.dlq
    routingKeys:
      videoHlsRequest: video.hls.request
      videoHlsRequestDlq: video.hls.request.dlq
    listenerConcurrency: 1-3

transcode:
  ladder:
    - { height: 1080, videoBitrate: "6000k", audioBitrate: "192k" }
    - { height: 720,  videoBitrate: "3000k", audioBitrate: "160k" }
    - { height: 480,  videoBitrate: "1200k", audioBitrate: "128k" }
    - { height: 360,  videoBitrate: "600k",  audioBitrate: "96k"  }
  gop: 48
  preset: veryfast
  crf: 21
  container: FMP4
  segmentDurationSec: 4
  ffprobeBinary: ffprobe
  ffprobeTimeoutSec: 30