spring:
  datasource:
    # Her test için random H2 (PostgreSQL uyum modu)
    url: jdbc:h2:mem:testdb-${random.uuid};MODE=PostgreSQL;DB_CLOSE_DELAY=-1;DATABASE_TO_UPPER=false
    username: sa
    password:
    driver-class-name: org.h2.Driver

  jpa:
    hibernate:
      ddl-auto: create-drop
    properties:
      hibernate:
        dialect: org.hibernate.dialect.H2Dialect
        format_sql: true
    open-in-view: false
    show-sql: false

  h2:
    console:
      enabled: false

  autoconfigure:
    exclude:
      # Rabbit tamamen kapalı (iki konfig de)
      - org.springframework.amqp.rabbit.autoconfigure.RabbitAutoConfiguration
      - org.springframework.amqp.rabbit.autoconfigure.RabbitAnnotationDrivenConfiguration
      # Redis kapalı
      - org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration

  rabbitmq:
    listener:
      simple:
        auto-startup: false
      direct:
        auto-startup: false

  # OAuth2 client test stub değerleri (gerekirse)
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: test-google-client-id
            client-secret: test-google-client-secret
            redirect-uri: "{baseUrl}/api/auth/google/callback"
            scope: [openid, email, profile]
        provider:
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://openidconnect.googleapis.com/v1/userinfo
            user-name-attribute: email

  data:
    redis:
      # Redis'i tamamen devre dışı bırak
      client-type: none

# Uygulama konfigleri (test modu)
app:
  jwt:
    secret: test-jwt-secret-key
    expiration: 3600000
    issuer: soundconnect-test

  data:
    init:
      enabled: false

  location:
    seed:
      enabled: false

otp:
  ttl:
    minutes: 3
  length: 6
  max-attempt: 5
  resend:
    cooldown:
      seconds: 30

# Mail test stub (MailerSend'e çıkmasın)
mailersend:
  api-key: test-mailersend-api-key
  from-email: test@soundconnect.app
  from-name: SoundConnect Test
  otp-validity-minutes: 3
  frontend-verify-url: http://localhost:3000/verify-email

# MEDIA / STORAGE (test/dummy)
cloud:
  storage:
    provider: fake          # Gerçek S3 yerine test double (kodda destekliyorsun)
    bucket: soundconnect-media-test
    region: eu-central-1
    accessKey: test-s3-access-key
    secretKey: test-s3-secret-key
    cdnBaseUrl: https://cdn.soundconnect.test
    endpoint: ""
    pathStyleAccess: false
    presign:
      expirySeconds: 900
    aclPublicReadOnPut: false

media:
  limits:
    imageMaxBytes: 20000000
    audioMaxBytes: 200000000
    videoMaxBytes: 4000000000
  allowedMime:
    image: [image/png, image/jpeg, image/webp]
    audio: [audio/mpeg, audio/aac, audio/wav, audio/x-wav, audio/ogg]
    video: [video/mp4, video/quicktime, video/x-matroska]
  paths:
    root: media
    hlsDir: hls
    sourceBasename: source

# Transcode ve kuyruklar testte kapalı
transcode:
  enabled: false
  ladder:
    - { height: 1080, videoBitrate: "6000k", audioBitrate: "192k" }
    - { height: 720,  videoBitrate: "3000k", audioBitrate: "160k" }
    - { height: 480,  videoBitrate: "1200k", audioBitrate: "128k" }
    - { height: 360,  videoBitrate: "600k",  audioBitrate: "96k"  }
  gop: 48
  preset: veryfast
  crf: 21
  container: FMP4
  segmentDurationSec: 4
  ffprobeBinary: ffprobe
  ffprobeTimeoutSec: 30

# Rabbit tanımları dursa da autoconfig kapalı olduğu için listener açılmaz
rabbitmq:
  media:
    exchange: media.transcode
    dlx: media.transcode.dlx
    queues:
      videoHls: media.transcode.video.hls
      videoHlsDlq: media.transcode.video.hls.dlq
    routingKeys:
      videoHlsRequest: video.hls.request
      videoHlsRequestDlq: video.hls.request.dlq
    listenerConcurrency: 1-3

logging:
  level:
    root: INFO
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql: WARN